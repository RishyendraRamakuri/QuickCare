<!DOCTYPE html>
<html>
<head>
  <title>Hospital Admin Dashboard</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    section { margin-bottom: 2rem; }
  </style>
</head>
<body>
  <h2>üè• Hospital Admin Dashboard</h2>
  <button onclick="logout()">Logout</button>

  <section>
    <h3>Hospital Info</h3>
    <div id="hospitalInfo">Loading...</div>
  </section>

  <section>
    <h3>Add Available Doctor</h3>
    <form id="addDoctorForm">
      <input name="name" placeholder="Doctor Name" required />
      <input name="specialization" placeholder="Specialization" required />
      <button type="submit">Add Doctor</button>
    </form>
    <ul id="doctorList"></ul>
  </section>

  <section>
    <h3>Set Queue & Schedule</h3>
    <form id="scheduleForm">
      <select id="doctorSelect"></select><br>
      <input name="time" placeholder="Time Slot (e.g., 2025-06-26T11:00)" required /><br>
      <button type="submit">Set Schedule</button>
    </form>
  </section>

  <script>
    const token = localStorage.getItem('token');
    if (!token) {
      alert('No token found, redirecting to login.');
      window.location.href = '/admin/login';
    }

    function authHeaders() {
      return { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' };
    }

    async function loadHospitalInfo() {
      const res = await fetch('/hospital-info', { headers: authHeaders() });
      const data = await res.json();
      document.getElementById('hospitalInfo').innerText =
        `${data.name}, ${data.location}, ${data.contact}`;
    }

    async function loadDoctors() {
      const res = await fetch('/api/doctors', { headers: authHeaders() });
      const doctors = await res.json();
      const list = document.getElementById('doctorList');
      const select = document.getElementById('doctorSelect');
      list.innerHTML = '';
      select.innerHTML = '';

      doctors.forEach(doc => {
        const li = document.createElement('li');
        li.textContent = `${doc.name} (${doc.specialization})`;
        list.appendChild(li);

        const opt = document.createElement('option');
        opt.value = doc.id;
        opt.textContent = doc.name;
        select.appendChild(opt);
      });
    }

    document.getElementById('addDoctorForm').onsubmit = async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      await fetch('/api/doctors', {
        method: 'POST',
        headers: authHeaders(),
        body: JSON.stringify({
          name: form.get('name'),
          specialization: form.get('specialization'),
        })
      });
      e.target.reset();
      loadDoctors();
    };

    document.getElementById('scheduleForm').onsubmit = async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      await fetch('/api/schedule', {
        method: 'POST',
        headers: authHeaders(),
        body: JSON.stringify({
          doctor_id: form.get('doctorSelect'),
          time: form.get('time'),
        })
      });
      e.target.reset();
      alert('Schedule set!');
    };

    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/admin/login';
    }

    loadHospitalInfo();
    loadDoctors();
  </script>
</body>
</html>
